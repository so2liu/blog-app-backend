(this["webpackJsonpblogs-app-front"]=this["webpackJsonpblogs-app-front"]||[]).push([[0],{18:function(e,t,n){e.exports=n(41)},41:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(17),s=n.n(o),c=n(3),u=n(1),i=n.n(u),l=n(5),p=n(4),m=n(6),d=n(7),f=n.n(d),v=f.a.create();function g(){return(g=Object(p.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("".concat("/api/auth","/login"),t);case 2:return n=e.sent,h(n.data.token),e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(p.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h(t),e.next=4,v.get("".concat("/api/auth","/validate"));case 4:return n=e.sent,e.abrupt("return",200===n.status);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}var y={login:function(e){return g.apply(this,arguments)},validateToken:function(e){return w.apply(this,arguments)}},h=function(e){var t={Authorization:"bearer ".concat(e)};v=f.a.create({headers:t})};var b=function(e){var t=e.setUser,n=e.setMessage,a=Object(m.a)({username:"",password:""}),o=Object(c.a)(a,2),s=o[0],u=o[1];function d(){return(d=Object(p.a)(i.a.mark((function e(a){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),console.log("log in with",s),e.prev=2,e.next=5,y.login(s);case 5:r=e.sent,t(r),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),n({message:e.t0.response.data.error,display:!0,type:"error"}),setTimeout((function(){n((function(e){return Object(l.a)(Object(l.a)({},e),{},{display:!1})}))}),5e3);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("h2",null,"Login"),r.a.createElement("form",{onSubmit:function(e){return d.apply(this,arguments)}},r.a.createElement("div",null,"username",r.a.createElement("input",{type:"text",name:"username",id:"loginUsername",onBlur:function(e){var t=e.target.value;u((function(e){e.username=t}))}})),r.a.createElement("div",null,"password",r.a.createElement("input",{type:"password",name:"password",id:"loginPassword",onBlur:function(e){var t=e.target.value;u((function(e){e.password=t}))}})),r.a.createElement("button",{type:"submit"},"Login")))};var E=function(e,t){var n=Object(a.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(a){return console.error(a),t}})),r=Object(c.a)(n,2),o=r[0],s=r[1];return[o,function(t){try{var n=t instanceof Function?t(o):t;s(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(a){throw console.log(a),a}},function(){try{window.localStorage.removeItem(e)}catch(t){console.log(t)}}]},O={localStorageKey:{user:"user"}};var j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{username:"",displayName:"",token:""},t=E(O.localStorageKey.user,e),n=Object(c.a)(t,3),r=n[0],o=n[1],s=n[2],u=Object(a.useState)(r.token?r:e),i=Object(c.a)(u,2),l=i[0],p=i[1];return Object(a.useEffect)((function(){""!==l.token&&y.validateToken(l.token).then((function(t){t?h(l.token):(p(e),s())}))}),[s,e,l.token]),Object(a.useEffect)((function(){""!==l.token?o(l):s()}),[l,o,s]),[l,p]},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return console.log(t,e),e};function x(){return(x=Object(p.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("/api/users",k(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S={signup:function(e){return x.apply(this,arguments)}};var B=function(e){var t=e.setUser,n=e.setMessage,a=Object(m.a)({username:"",displayName:"",password:"",confirmPassword:""}),o=Object(c.a)(a,2),s=o[0],u=o[1];function d(){return(d=Object(p.a)(i.a.mark((function e(a){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),f(s.password,s.confirmPassword)){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,S.signup(s);case 6:r=e.sent,k(r),t(r),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),n({message:e.t0.response.data.error,display:!0,type:"error"});case 14:case"end":return e.stop()}}),e,null,[[3,11]])})))).apply(this,arguments)}function f(e,t){var a=e===t;return n(a?function(e){return Object(l.a)(Object(l.a)({},e),{},{display:!1})}:{type:"error",message:"Two passwords are not same.",display:!0}),a}return r.a.createElement("div",null,r.a.createElement("h2",null,"Signup"),r.a.createElement("form",{onSubmit:function(e){return d.apply(this,arguments)}},r.a.createElement("div",null,"username",r.a.createElement("input",{type:"text",name:"username",id:"signupUsername",onBlur:function(e){var t=e.target.value;u((function(e){e.username=t}))}})),r.a.createElement("div",null,"display name",r.a.createElement("input",{type:"text",name:"displayname",id:"signupDisplayName",onBlur:function(e){var t=e.target.value;u((function(e){e.displayName=t}))}})),r.a.createElement("div",null,"password",r.a.createElement("input",{type:"password",name:"password",id:"signupPassword",onBlur:function(e){var t=e.target.value;u((function(e){e.password=t}))}})),r.a.createElement("div",null,"password",r.a.createElement("input",{type:"password",name:"password",id:"signupPassword",onBlur:function(e){var t=e.target.value;u((function(e){e.confirmPassword=t})),f(s.password,t)}})),r.a.createElement("button",{type:"submit"},"Login")))};var N=function(e){var t=e.setUser;return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){t({username:"",displayName:"",token:""})}},"Logout"))};var U=function(e){var t=e.json;return r.a.createElement("div",null,r.a.createElement("pre",{style:{maxWidth:"100%",overflow:"auto"}},JSON.stringify(t,null,2)))};var P=function(){var e=j(),t=Object(c.a)(e,2),n=t[0],o=t[1],s=Object(a.useState)({display:!1,message:"",type:"error"}),u=Object(c.a)(s,2),i=u[0],l=u[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(U,{json:n}),r.a.createElement("h1",null,"Blog App"),r.a.createElement("strong",null,n.displayName),i.display&&r.a.createElement("strong",null,i.message),r.a.createElement(b,{setUser:o,setMessage:l}),r.a.createElement(N,{setUser:o}),r.a.createElement(B,{setUser:o,setMessage:l}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[18,1,2]]]);
//# sourceMappingURL=main.975ce6c5.chunk.js.map